<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>hello phaser!</title>
        <script src="/bower_components/phaser/build/phaser.js"></script>
    </head>
    <body>

    <script type="text/javascript">

    window.onload = function() {

        var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create });
        
        var terrain;
        
        var gui = new GameUI();
        
        function GameUI() {
            var ui = this;
            
            this.preload = function () {
                
            };
            
            this.create = function() {
                ui.score = 0;
                ui.scoreText = game.add.text(16, 16, 'score: 0',  { fontSize: '32px', fill: '#000' });
            };
            
            this.update = function () {
                
            };
        };
        
        function TileSheetFactory(key, path, cols, rows, size) {
            size = size || 32;
            
            this.preload = function () {
                game.load.spritesheet(key, path, size, size);
            }
            
            this.generateSprite = function(x, y, i, j) {
                var index = i + j * cols;
                if (i + j * cols > cols * rows - 1) {
                    return undefined;
                }
                var s = game.add.sprite(x, y, key, i + j * cols);
                    s.anchor.setTo(0, 0);
                return s;
            }
        }
        
        function TilesAssets (prefix) {
            prefix = prefix || 'land_';

            this.tilesFactory = {
                'coldwatergrass': new TileSheetFactory(prefix + 'coldwatergrass', 'assets/coldwatergrass.png', 5, 6),
                'icegrass': new TileSheetFactory(prefix + 'icegrass', 'assets/icegrass.png', 5, 6),
                'plowed_soil': new TileSheetFactory(prefix + 'plowed_soil', 'assets/plowed_soil.png', 5, 6),
                'tallgrass': new TileSheetFactory(prefix + 'tallgrass', 'assets/tallgrass.png', 5, 6),
                'wheat': new TileSheetFactory(prefix + 'wheat', 'assets/wheat.png', 5, 6),
            };
            
            this.preload = function () {
                for (var k in this.tilesFactory) {
                    this.tilesFactory[k].preload();
                }
            }
        };
        
        var landscapeAssets = new TilesAssets();

        function preload () {
            landscapeAssets.preload();
            gui.preload();
        }

        function create () {
            terrain = game.add.group();
            
            gui.create();
            
            for (var i = 0; i < 5; i++) {
                for (var j = 0; j < 6; j++) {
                    landscapeAssets.tilesFactory['coldwatergrass'].generateSprite(game.world.centerX + i * 32, 
                        game.world.centerY + j * 32, i, j);
                }
            }
            
            // for (var i = 0; i < 5; i++) {
            //     for (var j = 0; j < 6; j++) {
            //         var s = game.add.sprite(game.world.centerX + i * 32, 
            //             game.world.centerY + j * 32, 'land_coldwatergrass', i + j * 5);
            //         s.anchor.setTo(0.5, 0.5);
            //     }
            // }
        }
        
        function update() {
            
            gui.update();
        }

    };

    </script>

    </body>
</html>
